// config-overrides.js
// see: https://github.com/timarney/react-app-rewired

const path = require("path");
const fs = require("fs");

const rewireBabelLoader = require("react-app-rewire-babel-loader");

// helpers

const appDirectory = fs.realpathSync(process.cwd());
const resolveApp = (relativePath) => path.resolve(appDirectory, relativePath);

module.exports = function override(config, env) {

  // Ignore warnings about source maps generated by react-scripts
  config.ignoreWarnings = [
    /Failed to parse source map/,
  ];

  // Add resolve.fallback configuration
  config.resolve = {
    ...config.resolve,
    fallback: {
      ...config.resolve.fallback,
      path: require.resolve("path-browserify"),
    },
  };
  // white-list some npm modules to the babel-loader pipeline
  // see: https://webpack.js.org/configuration/module/#rule-include

  config = rewireBabelLoader.include(
    config,
    resolveApp("node_modules/isemail"),
    resolveApp("../login"),
    resolveApp("../dashboard"),
    resolveApp("../common"),
    resolveApp("../account"),
    resolveApp("../candidate"),
    resolveApp("../job"),
    resolveApp("../settings"),
    resolveApp("../formbuilder"),
    resolveApp("../template")
  );

  // black-list some modules from the babel-loader pipeline
  // see: https://webpack.js.org/configuration/module/#rule-exclude

  config = rewireBabelLoader.exclude(config, /(node_modules|bower_components)/);

  return config;
};
